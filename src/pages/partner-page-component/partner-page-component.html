<ion-header>
  <typeahead *ngIf="searchInterfaceOpen"
             (closeSearchInterfaceEmitter)="closeSearchInterface($event)"
             (getPartnersWithSearchTermEmitter)="getPartnersWithSearchTerm($event)"
             (toggleMapAndListEmitter)="toggleMapAndList()"
             [mapIcon]='activeFilterFromMenu == "OFFLINEPARTNER"  && !showTryAgainToGetPartnersButton'>
  </typeahead>

  <div class="standard-header" *ngIf="!searchInterfaceOpen">
    <ion-navbar primary>
      <ion-buttons left>
        <button menuToggle *ngIf="!searchInterfaceOpen">
          <ion-icon name="menu" color="grey" class="menu-button-header"></ion-icon>
        </button>
      </ion-buttons>


      <ion-buttons left *ngIf="showCustomBackButton" (click)="customBackButtonClicked()">
        <button>
          <ion-icon class="back-button-icon icon icon-md back-button-icon-md ion-md-arrow-back" color="grey"></ion-icon>
        </button>
      </ion-buttons>

      <ion-title>
        {{title}}
      </ion-title>
      <input id="mySearchInputField"
             placeholder="Geben Sie einen Suchbegriff ein"
             (keyup)="inputToSuggestions($event)"
             [(ngModel)]="searchTerm"
             *ngIf="searchInterfaceOpen">
      <ion-buttons end>
        <button (click)="searchInterfaceOpen = true">
          <ion-icon name="search" color="grey" class="search-button-header"></ion-icon>
        </button>
      </ion-buttons>
      <ion-buttons end *ngIf="showOfflinePartners && !showTryAgainToGetPartnersButton">
        <button (click)="toggleMapAndList()" class="mapIcon">
          <div class="toggleListAndMapIcon" [class.mapIcon]="!showMap"></div>
        </button>
      </ion-buttons>
    </ion-navbar>
    <ion-toolbar>
      <ion-row *ngIf="!showMap" class="filter-button-row" [class.dropdownOpen]="showDropdown[2]">
        <ion-col tappable class="filter-button left-button" (click)="toggleVisibilityDropdowns(0)">
          <div class="filter-button-text" [class.notActive]="showDropdown[1]">Filter
            <ion-icon name="arrow-dropdown" [class.singleButton]="showMap"></ion-icon>
          </div>
        </ion-col>
        <ion-col tappable class="filter-button" (click)="toggleVisibilityDropdowns(1)">
          <div class="filter-button-text" [class.notActive]="showDropdown[0]">Sortieren
            <ion-icon name="arrow-dropdown"></ion-icon>
          </div>
        </ion-col>
      </ion-row>

      <ion-row class="filter-button-row" *ngIf="showMap" [class.dropdownOpen]="showDropdown[2]">
        <ion-col tappable class="filter-button left-button singleButton" (click)="toggleVisibilityDropdowns(0)">
          <div class="filter-button-text" [class.notActive]="showDropdown[1]">Filter
            <ion-icon name="arrow-dropdown"></ion-icon>
          </div>
        </ion-col>
      </ion-row>
    </ion-toolbar>
  </div>



</ion-header>


<ion-content>


    <div class="filter-wrapper">


      <div class="filter-menu" [@show]="showDropdownForAnimation[0]">
        <ion-row class="currentLocation" *ngIf="(offlinePartnerPageComponent || searchPageComponent) && !showMap ">
          <ion-col class="currentPosition" *ngIf="getLocationFromGPSEnabled">
            Aktueller Standort
          </ion-col>
          <ion-col class="currentPosition" *ngIf="!getLocationFromGPSEnabled" (click)="chooseLocationManually()">
            <p class="cityName">{{cityName}}</p>
            <p class="changeLocation">Ort ändern</p>
          </ion-col>
          <ion-col tappable class="map-icon" (click)="toggleGetLocationFromGPSEnabled()" *ngIf="!waitingForGPSSignal">
            <div [class.manually]="!getLocationFromGPSEnabled"></div>
          </ion-col>
          <ion-col>
            <ion-spinner *ngIf="waitingForGPSSignal" class="waitingForGPSSignalSpinner"></ion-spinner>
          </ion-col>
        </ion-row>

        <ion-row tappable class="toggle offline-partner-toggle" (click)="showOfflinePartners = !showOfflinePartners"
                 *ngIf="searchPageComponent">
          <ion-col class="toggle-text">Vor-Ort Partner</ion-col>
          <ion-col class="toggle">
            <ion-toggle [(ngModel)]="showOfflinePartners" color="light-blue" mode="ios"
                        [class.checked]="showOfflinePartners"></ion-toggle>
          </ion-col>
        </ion-row>

        <ion-row tappable class="toggle online-partner-toggle" (click)="showOnlinePartners = !showOnlinePartners"
                 *ngIf="searchPageComponent">
          <ion-col class="toggle-text">Online Partner</ion-col>
          <ion-col class="toggle">
            <ion-toggle color="light-blue" [(ngModel)]="showOnlinePartners" mode="ios"
                        [class.checked]="showOnlinePartners"></ion-toggle>
          </ion-col>
        </ion-row>

        <ion-row tappable class="toggle has-campaign-partner-toggle"
                 (click)="showOnlyPartnersWithCampaign = !showOnlyPartnersWithCampaign"
                 [class.biggerMarginTop]="onlinePartnerPageComponent || showMap">
          <ion-col class="toggle-text">Nur Partner mit Aktionen</ion-col>
          <ion-col class="toggle">
            <ion-toggle color="light-blue" mode="ios" [(ngModel)]="showOnlyPartnersWithCampaign"></ion-toggle>
          </ion-col>
        </ion-row>

        <div class="showSelectionWrapper">
          <button
            class="showSelection"
            ion-button color="primary"
            (click)="filterButtonPushed()"
            [class.searchPageComponent]="searchPageComponent"
            [class.onlinePartnerPageComponent]="onlinePartnerPageComponent || showMap">
            Auswahl anzeigen
          </button>
        </div>
      </div>

      <div class="filter-menu" [@show]="showDropdownForAnimation[1]">
        <ion-item tappable class = "sort-by" (click) = "sortBy(0, 'RELEVANCE', 'DESC')">
            Relevanz
          <ion-icon name="checkmark" item-end  color="primary" item-end *ngIf="sortByArray[0]"></ion-icon>
        </ion-item>
        <ion-item tappable class = "sort-by" (click) = "sortBy(1, 'POPULARITY', 'DESC')">
          Beliebtheit
          <ion-icon name="checkmark" item-end  color="primary" item-end *ngIf="sortByArray[1]"></ion-icon>
        </ion-item>
        <ion-item tappable class = "sort-by" (click) = "sortBy(2, 'PRICE', 'ASC')">
          Preis (aufsteigend)
          <ion-icon name="checkmark" item-end  color="primary" item-end *ngIf="sortByArray[2]"></ion-icon>
        </ion-item>
        <ion-item tappable class = "sort-by" (click) = "sortBy(3, 'PRICE', 'DESC')">
          Preis (absteigend)
          <ion-icon name="checkmark" item-end  color="primary" item-end *ngIf="sortByArray[3]"></ion-icon>
        </ion-item>
        <ion-item tappable class = "sort-by" (click) = "sortBy(4, 'SHORTNAME', 'ASC')">
          Alphabet (A-Z)
          <ion-icon name="checkmark" item-end  color="primary" item-end *ngIf="sortByArray[4]"></ion-icon>
        </ion-item>
        <ion-item tappable class = "sort-by" (click) = "sortBy(5, 'SHORTNAME', 'DESC')">
          Alphabet (Z-A)
          <ion-icon name="checkmark" item-end  color="primary" item-end *ngIf="sortByArray[5]"></ion-icon>
        </ion-item>
        <ion-item tappable class = "sort-by" (click) = "sortBy(6, 'DISTANCE', 'ASC')" *ngIf="offlinePartnerPageComponent">
        Distanz
          <ion-icon name="checkmark" item-end  color="primary" item-end *ngIf="sortByArray[6]"></ion-icon>
        </ion-item>
      </div>


    </div>

    <div class="initialSpinner" *ngIf="waitingForResults">
      <ion-spinner tappable class="initialSpinner" (click)="hideDropdown()"></ion-spinner>
    </div>


    <ion-item *ngIf="noPartnersToDisplay" text-wrap>
      Wir können Ihnen leider derzeit keine Partner anzeigen.
    </ion-item>

    <div *ngIf="showTryAgainToGetPartnersButton">
      <ion-item  text-wrap>
        Der Aufruf hat einen Fehler zurückgegeben.
        <button ion-button item-right (click)="getPartners(); showTryAgainToGetPartnersButton = false">Erneut versuchen</button>
      </ion-item>
    </div>


    <div tappable class="partner-table-wrapper" (click)="hideDropdown()" *ngIf="!showMap">
      <partner-table [partners]="displayedPartners"
                     (showPartnerEventEmitter)="showPartner($event)"></partner-table>
    </div>

    <div *ngIf="!showMap">
      <ion-infinite-scroll (ionInfinite)="doInfinite($event)" *ngIf="moreDataCanBeLoaded">
        <ion-infinite-scroll-content>
          <ion-spinner class="initialSpinner"></ion-spinner>
        </ion-infinite-scroll-content>
      </ion-infinite-scroll>
    </div>

    <partner-map [justPartnersWithCampaign$]="justPartnersWithCampaign$"
                 [justPartnersWithCampaign]="showOnlyPartnersWithCampaign"
                 [searchTerm$]="searchTerm$"
                 [searchTerm]="searchTerm"
                 *ngIf="showMap"
                 (onListUpdated)="scrollToTop()"></partner-map>

</ion-content>

